<%- include('partials/header', { title: 'Product Details', cssFile: 'product.css' }) %>

<div class="container mx-auto mt-8">
    <div class="flex flex-col md:flex-row gap-8">
        <div class="md:w-1/2">
            <!-- Check if the product has images, otherwise display a placeholder -->
            <% if (product.images && product.images.length > 0) { %>
                <img src="/images/<%= product.images[0] %>" class="rounded-lg shadow-md" alt="<%= product.name %>" style="width:100%; height:auto;">
            <% } else { %>
                <img src="https://via.placeholder.com/800x800" class="rounded-lg shadow-md" alt="<%= product.name %>" style="width:100%; height:auto;">
            <% } %>
        </div>
        <div class="md:w-1/2">
            <h2 class="text-2xl font-bold text-gray-800 mb-4"><%= product.name %></h2>
            <p class="text-xl text-gray-600 mb-2"><strong>Price:</strong> $<%= (parseFloat(product.price) || 0).toFixed(2) %></p>
            <% if (product.discount_amount > 0) { %>
                <p class="text-lg text-red-500 mb-2"><strong>Discount:</strong> $<%= product.discount_amount %></p>
            <% } %>
            <p class="text-md text-gray-700 mb-4"><strong>Description:</strong> <%= product.description %></p>
            <p class="text-md text-gray-700 mb-2"><strong>Category:</strong> <%= product.category %></p>
            <p class="text-md text-gray-700 mb-2"><strong>Subcategory:</strong> <%= product.subcategory %></p>
            <p class="text-md text-gray-700 mb-2"><strong>Brand:</strong> <%= product.brand %></p>
            <p class="text-md text-gray-700 mb-2"><strong>In Stock:</strong> <%= product.stock %></p>
            <p class="text-md text-gray-700 mb-2"><strong>Warranty:</strong> <%= product.warranty %></p>

            <!-- Add to Cart section -->
            <div class="mt-6">
                <label for="quantity" class="block text-sm font-medium text-gray-700 mb-2">Quantity</label>
                <input type="number" id="quantity" value="1" min="1" class="block w-20 border border-gray-300 rounded-md shadow-sm p-2 mb-4">

                <!-- If user is logged in, show Add to Cart button -->
                <% if (user) { %>
                    <button class="bg-blue-500 text-white px-6 py-2 rounded-md shadow-md hover:bg-blue-600 transition" onclick="addToCart('<%= product.product_id %>', <%= product.price %>)">Add to Cart</button>
                <% } else { %>
                    <!-- If user is not logged in, show Login to Continue button -->
                    <button class="bg-gray-400 text-white px-6 py-2 rounded-md shadow-md" onclick="showLoginModal()">Login to Continue</button>
                <% } %>
            </div>
        </div>
    </div>
</div>

<!-- Modal for Login Prompt -->
<div class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 hidden" id="loginModal">
    <div class="bg-white rounded-lg shadow-lg p-6">
        <h5 class="text-lg font-bold mb-4">Login Required</h5>
        <p class="mb-6">You need to log in or create an account to add products to your cart.</p>
        <div class="flex justify-end space-x-4">
            <a href="/login" class="bg-blue-500 text-white px-4 py-2 rounded-md shadow hover:bg-blue-600 transition">Login</a>
            <a href="/register" class="bg-gray-400 text-white px-4 py-2 rounded-md shadow hover:bg-gray-500 transition">Create Account</a>
        </div>
    </div>
</div>

<%- include('partials/footer') %>

<script>
    const currentUserId = "<%= user ? user.id : '' %>";

    // Function to add a product to the cart for logged-in users
    async function addToCart(productId) {
        const quantity = parseInt(document.getElementById('quantity').value);

        if (!quantity || quantity <= 0) {
            alert('Please enter a valid quantity.');
            return;
        }

        try {
            const response = await fetch('/cart/add', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    product_id: productId,
                    quantity: quantity
                }),
            });

            if (response.ok) {
                alert('Product added to cart!');
            } else {
                alert('Error adding product to cart.');
            }
        } catch (error) {
            console.error('Error adding product to cart:', error);
        }
    }

    // Function to show the login modal for non-logged-in users
    function showLoginModal() {
        document.getElementById('loginModal').classList.remove('hidden');
    }
</script>
</body>
</html>
